<!DOCTYPE html>
<html>
	<head>
		<title>CS3750 Game of Life</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	    <!--Reference the SignalR library. -->
	    <script src="Scripts/jquery.signalR-2.2.1.min.js"></script> <!-- TODO: Where is this on the server? -->
	    <!--Reference the autogenerated SignalR hub script. -->
	    <script src="signalr/hubs"></script> <!-- TODO: do we need this? -->
		<script type="text/javascript">
let color = '#FF0000';

let numCells = 30;
let cells = new Array(numCells);
for (let x = 0; x < numCells; x++) {
	let column = new Array(numCells);
	for (let y = 0; y < numCells; y++) {
		column[y] = '#FFFFFF';
	}
	cells[x] = column;
}

let lineWidth = 2;
let canvas;
let width;
let scale;
let context;
let hub;

function drawCell(x, y) {
	context.fillStyle = cells[x][y];
	context.beginPath();
	context.rect(x * scale + lineWidth, y * scale + lineWidth, scale - lineWidth, scale - lineWidth);
	context.fill();
}

function drawCells(cells) {
	for (let x = 0; x < numCells; x++) {
		for (let y = 0; y < numCells; y++) {
			drawCell(x, y);
		}
	}
}

function drawGrid() {
	context.fillStyle = '#000000';
	context.beginPath();
	context.rect(0, 0, width, width);
	context.fill();
	
	drawCells();
}

function sendClick(x, y){
	let curColor = cells[x][y];
	if (curColor == color){
		curColor = '#FFFFFF';
	} else {
		curColor = color;
	}
	cells[x][y] = curColor;
	drawCell(x, y);
	hub.click(x, y, color);
}

function sendPlay(){
	hub.play();
}

function sendPause(){
	hub.pause();
}

function sendReset(){
	hub.reset();
}

function setCells(newCells){
	cells = newCells();
	drawGrid();
}

function onClick(e){
	let boundingRect = canvas.getBoundingClientRect();
	let x = Math.floor((e.clientX - boundingRect.left)/scale);
	let y = Math.floor((e.clientY - boundingRect.top)/scale);
	sendClick(x, y);
}

function onReady(){
	canvas = $('canvas')[0];
	width = canvas.width;
	scale = (width - 1) / numCells;
	context = canvas.getContext('2d');
	canvas.onclick = onClick;

	hub = $.connection.hub;
	hub.client.setCells = setCells;
	hub.start();

	drawGrid();
}

function onColorChange(){
	color = $('select')[0].value;
}

$(document).ready(onReady);
		</script>
		<style type="text/css">
canvas {
	border: 2px solid black;
}
.center {
	display: block;
	margin-left: auto;
	margin-right: auto;
}
#main {
	background-color: #777777;
	padding: 20px;
}
#controls {
	background-color: #444444;
	margin-top: 20px;
	padding: 10px;
}
button, select {
	width: 25%;
	height: 30px;
	font-size: 20px;
	margin: 0px;
	padding: 0px;
	display: inline-block;
}
body {
	margin: 0px;
	background-color: #000000;
}
		</style>
	</head>
	<body>
		<div id="main" class="center" width="100%">
			<canvas class="center" width="800" height="800">
				HTML5 Canvas not supported
			</canvas>
			<div id="controls">
				<button onclick="sendPlay()"><b>Play</b></button><!--
				--><button onclick="sendPause()"><b>Pause</b></button><!--
				--><button onclick="sendReset()"><b>Reset</b></button><!--
				--><select onchange="onColorChange()">
					<option value="#FF0000">Red</option>
					<option value="#00FF00">Green</option>
					<option value="#0000FF">Blue</option>
				</select>
			</div>
		</div>
	</body>
</html>